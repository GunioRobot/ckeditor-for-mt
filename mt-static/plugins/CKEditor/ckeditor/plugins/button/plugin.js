CKEDITOR.plugins.add('button',{beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_BUTTON,CKEDITOR.ui.button.handler);}});CKEDITOR.UI_BUTTON=1;CKEDITOR.ui.button=function(a){CKEDITOR.tools.extend(this,a,{title:a.label,className:a.className||a.command&&'cke_button_'+a.command||'',click:a.click||(function(b){b.execCommand(a.command);})});this._={};};CKEDITOR.ui.button.handler={create:function(a){return new CKEDITOR.ui.button(a);}};CKEDITOR.ui.button._={instances:[],keydown:function(a,b){var c=CKEDITOR.ui.button._.instances[a];if(c.onkey){b=new CKEDITOR.dom.event(b);return c.onkey(c,b.getKeystroke())!==false;}},focus:function(a,b){var c=CKEDITOR.ui.button._.instances[a],d;if(c.onfocus)d=c.onfocus(c,new CKEDITOR.dom.event(b))!==false;if(CKEDITOR.env.gecko&&CKEDITOR.env.version<10900)b.preventBubble();return d;}};(function(){var a=CKEDITOR.tools.addFunction(CKEDITOR.ui.button._.keydown,CKEDITOR.ui.button._),b=CKEDITOR.tools.addFunction(CKEDITOR.ui.button._.focus,CKEDITOR.ui.button._);CKEDITOR.ui.button.prototype={canGroup:true,render:function(c,d){var e=CKEDITOR.env,f=this._.id=CKEDITOR.tools.getNextId(),g='',h=this.command,i,j;this._.editor=c;var k={id:f,button:this,editor:c,focus:function(){var n=CKEDITOR.document.getById(f);n.focus();},execute:function(){this.button.click(c);}};k.clickFn=i=CKEDITOR.tools.addFunction(k.execute,k);k.index=j=CKEDITOR.ui.button._.instances.push(k)-1;if(this.modes){var l={};c.on('beforeModeUnload',function(){l[c.mode]=this._.state;},this);c.on('mode',function(){var n=c.mode;this.setState(this.modes[n]?l[n]!=undefined?l[n]:CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);},this);}else if(h){h=c.getCommand(h);if(h){h.on('state',function(){this.setState(h.state);},this);g+='cke_'+(h.state==CKEDITOR.TRISTATE_ON?'on':h.state==CKEDITOR.TRISTATE_DISABLED?'disabled':'off');}}if(!h)g+='cke_off';if(this.className)g+=' '+this.className;d.push('<span class="cke_button'+(this.icon&&this.icon.indexOf('.png')==-1?' cke_noalphafix':'')+'">','<a id="',f,'" class="',g,'"',e.gecko&&e.version>=10900&&!e.hc?'':'" href="javascript:void(\''+(this.title||'').replace("'",'')+"')\"",' title="',this.title,'" tabindex="-1" hidefocus="true" role="button" aria-labelledby="'+f+'_label"'+(this.hasArrow?' aria-haspopup="true"':''));if(e.opera||e.gecko&&e.mac)d.push(' onkeypress="return false;"');if(e.gecko)d.push(' onblur="this.style.cssText = this.style.cssText;"');d.push(' onkeydown="return CKEDITOR.tools.callFunction(',a,', ',j,', event);" onfocus="return CKEDITOR.tools.callFunction(',b,', ',j,', event);" onclick="CKEDITOR.tools.callFunction(',i,', this); return false;"><span class="cke_icon"');
if(this.icon){var m=(this.iconOffset||0)*-16;d.push(' style="background-image:url(',CKEDITOR.getUrl(this.icon),');background-position:0 '+m+'px;"');}d.push('>&nbsp;</span><span id="',f,'_label" class="cke_label">',this.label,'</span>');if(this.hasArrow)d.push('<span class="cke_buttonarrow">'+(CKEDITOR.env.hc?'&#9660;':'&nbsp;')+'</span>');d.push('</a>','</span>');if(this.onRender)this.onRender();return k;},setState:function(c){if(this._.state==c)return false;this._.state=c;var d=CKEDITOR.document.getById(this._.id);if(d){d.setState(c);c==CKEDITOR.TRISTATE_DISABLED?d.setAttribute('aria-disabled',true):d.removeAttribute('aria-disabled');c==CKEDITOR.TRISTATE_ON?d.setAttribute('aria-pressed',true):d.removeAttribute('aria-pressed');return true;}else return false;}};})();CKEDITOR.ui.prototype.addButton=function(a,b){this.add(a,CKEDITOR.UI_BUTTON,b);};CKEDITOR.on('reset',function(){CKEDITOR.ui.button._.instances=[];});
