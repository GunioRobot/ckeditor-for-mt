(function(){CKEDITOR.plugins.add('enterkey',{requires:['keystrokes','indent'],init:function(h){var i=h.specialKeys;i[13]=f;i[CKEDITOR.SHIFT+13]=e;}});CKEDITOR.plugins.enterkey={enterBlock:function(h,i,j,k){j=j||g(h);if(!j)return;var l=j.document;if(j.checkStartOfBlock()&&j.checkEndOfBlock()){var m=new CKEDITOR.dom.elementPath(j.startContainer),n=m.block;if(n&&(n.is('li')||n.getParent().is('li'))){h.execCommand('outdent');return;}}var o=i==CKEDITOR.ENTER_DIV?'div':'p',p=j.splitBlock(o);if(!p)return;var q=p.previousBlock,r=p.nextBlock,s=p.wasStartOfBlock,t=p.wasEndOfBlock,u;if(r){u=r.getParent();if(u.is('li')){r.breakParent(u);r.move(r.getNext(),1);}}else if(q&&(u=q.getParent())&&u.is('li')){q.breakParent(u);u=q.getNext();j.moveToElementEditStart(u);q.move(q.getPrevious());}if(!s&&!t){if(r.is('li')&&(u=r.getFirst(CKEDITOR.dom.walker.invisible(true)))&&u.is&&u.is('ul','ol'))(CKEDITOR.env.ie?l.createText('\xa0'):l.createElement('br')).insertBefore(u);if(r)j.moveToElementEditStart(r);}else{var v,w;if(q){if(q.is('li')||!d.test(q.getName())){v=q.clone();v.is('li')&&v.removeAttribute('value');}}else if(r)v=r.clone();if(!v){if(u&&u.is('li'))v=u;else{v=l.createElement(o);if(q&&(w=q.getDirection()))v.setAttribute('dir',w);}}else if(k&&!v.is('li'))v.renameNode(o);var x=p.elementPath;if(x)for(var y=0,z=x.elements.length;y<z;y++){var A=x.elements[y];if(A.equals(x.block)||A.equals(x.blockLimit))break;if(CKEDITOR.dtd.$removeEmpty[A.getName()]){A=A.clone();v.moveChildren(A);v.append(A);}}if(!CKEDITOR.env.ie)v.appendBogus();if(!v.getParent())j.insertNode(v);if(CKEDITOR.env.ie&&s&&(!t||!q.getChildCount())){j.moveToElementEditStart(t?q:v);j.select();}j.moveToElementEditStart(s&&!t?r:v);}if(!CKEDITOR.env.ie)if(r){var B=l.createElement('span');B.setHtml('&nbsp;');j.insertNode(B);B.scrollIntoView();j.deleteContents();}else v.scrollIntoView();j.select();},enterBr:function(h,i,j,k){j=j||g(h);if(!j)return;var l=j.document,m=i==CKEDITOR.ENTER_DIV?'div':'p',n=j.checkEndOfBlock(),o=new CKEDITOR.dom.elementPath(h.getSelection().getStartElement()),p=o.block,q=p&&o.block.getName(),r=false;if(!k&&q=='li'){c(h,i,j,k);return;}if(!k&&n&&d.test(q)){var s,t;if(t=p.getDirection()){s=l.createElement('div');s.setAttribute('dir',t);s.insertAfter(p);j.setStart(s,0);}else{l.createElement('br').insertAfter(p);if(CKEDITOR.env.gecko)l.createText('').insertAfter(p);j.setStartAt(p.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START);}}else{var u;r=q=='pre';if(r&&!CKEDITOR.env.gecko)u=l.createText(CKEDITOR.env.ie?'\r':'\n');
else u=l.createElement('br');j.deleteContents();j.insertNode(u);if(CKEDITOR.env.ie)j.setStartAt(u,CKEDITOR.POSITION_AFTER_END);else{l.createText('\ufeff').insertAfter(u);if(n)u.getParent().appendBogus();u.getNext().$.nodeValue='';j.setStartAt(u.getNext(),CKEDITOR.POSITION_AFTER_START);var v=null;if(!CKEDITOR.env.gecko){v=l.createElement('span');v.setHtml('&nbsp;');}else v=l.createElement('br');v.insertBefore(u.getNext());v.scrollIntoView();v.remove();}}j.collapse(true);j.select(r);}};var a=CKEDITOR.plugins.enterkey,b=a.enterBr,c=a.enterBlock,d=/^h[1-6]$/;function e(h){if(h.mode!='wysiwyg')return false;if(h.getSelection().getStartElement().hasAscendant('pre',true)){setTimeout(function(){c(h,h.config.enterMode,null,true);},0);return true;}else return f(h,h.config.shiftEnterMode,1);};function f(h,i,j){j=h.config.forceEnterMode||j;if(h.mode!='wysiwyg')return false;if(!i)i=h.config.enterMode;setTimeout(function(){h.fire('saveSnapshot');if(i==CKEDITOR.ENTER_BR||h.getSelection().getStartElement().hasAscendant('pre',1))b(h,i,null,j);else c(h,i,null,j);},0);return true;};function g(h){var i=h.getSelection().getRanges(true);for(var j=i.length-1;j>0;j--)i[j].deleteContents();return i[0];};})();
