CKEDITOR.plugins.add('link',{init:function(a){a.addCommand('link',new CKEDITOR.dialogCommand('link'));a.addCommand('anchor',new CKEDITOR.dialogCommand('anchor'));a.addCommand('unlink',new CKEDITOR.unlinkCommand());a.ui.addButton('Link',{label:a.lang.link.toolbar,command:'link'});a.ui.addButton('Unlink',{label:a.lang.unlink,command:'unlink'});a.ui.addButton('Anchor',{label:a.lang.anchor.toolbar,command:'anchor'});CKEDITOR.dialog.add('link',this.path+'dialogs/link.js');CKEDITOR.dialog.add('anchor',this.path+'dialogs/anchor.js');var b=a.lang.dir=='rtl'?'right':'left';a.addCss('img.cke_anchor{background-image: url('+CKEDITOR.getUrl(this.path+'images/anchor.gif')+');'+'background-position: center center;'+'background-repeat: no-repeat;'+'border: 1px solid #a9a9a9;'+'width: 18px !important;'+'height: 18px !important;'+'}\n'+'a.cke_anchor'+'{'+'background-image: url('+CKEDITOR.getUrl(this.path+'images/anchor.gif')+');'+'background-position: '+b+' center;'+'background-repeat: no-repeat;'+'border: 1px solid #a9a9a9;'+'padding-'+b+': 18px;'+'}');a.on('selectionChange',function(c){var d=a.getCommand('unlink'),e=c.data.path.lastElement&&c.data.path.lastElement.getAscendant('a',true);if(e&&e.getName()=='a'&&e.getAttribute('href'))d.setState(CKEDITOR.TRISTATE_OFF);else d.setState(CKEDITOR.TRISTATE_DISABLED);});a.on('doubleclick',function(c){var d=CKEDITOR.plugins.link.getSelectedLink(a)||c.data.element;if(!d.isReadOnly())if(d.is('a'))c.data.dialog=d.getAttribute('name')&&!d.getAttribute('href')?'anchor':'link';else if(d.is('img')&&d.data('cke-real-element-type')=='anchor')c.data.dialog='anchor';});if(a.addMenuItems)a.addMenuItems({anchor:{label:a.lang.anchor.menu,command:'anchor',group:'anchor'},link:{label:a.lang.link.menu,command:'link',group:'link',order:1},unlink:{label:a.lang.unlink,command:'unlink',group:'link',order:5}});if(a.contextMenu)a.contextMenu.addListener(function(c,d){if(!c||c.isReadOnly())return null;var e=c.is('img')&&c.data('cke-real-element-type')=='anchor';if(!e){if(!(c=CKEDITOR.plugins.link.getSelectedLink(a)))return null;e=c.getAttribute('name')&&!c.getAttribute('href');}return e?{anchor:CKEDITOR.TRISTATE_OFF}:{link:CKEDITOR.TRISTATE_OFF,unlink:CKEDITOR.TRISTATE_OFF};});},afterInit:function(a){var b=a.dataProcessor,c=b&&b.dataFilter;if(c)c.addRules({elements:{a:function(d){var e=d.attributes;if(e.name&&!e.href)return a.createFakeParserElement(d,'cke_anchor','anchor');}}});},requires:['fakeobjects']});CKEDITOR.plugins.link={getSelectedLink:function(a){try{var b=a.getSelection();
if(b.getType()==CKEDITOR.SELECTION_ELEMENT){var c=b.getSelectedElement();if(c.is('a'))return c;}var d=b.getRanges(true)[0];d.shrink(CKEDITOR.SHRINK_TEXT);var e=d.getCommonAncestor();return e.getAscendant('a',true);}catch(f){return null;}}};CKEDITOR.unlinkCommand=function(){};CKEDITOR.unlinkCommand.prototype={exec:function(a){var b=a.getSelection(),c=b.createBookmarks(),d=b.getRanges(),e,f;for(var g=0;g<d.length;g++){e=d[g].getCommonAncestor(true);f=e.getAscendant('a',true);if(!f)continue;d[g].selectNodeContents(f);}b.selectRanges(d);a.document.$.execCommand('unlink',false,null);b.selectBookmarks(c);},startDisabled:true};CKEDITOR.tools.extend(CKEDITOR.config,{linkShowAdvancedTab:true,linkShowTargetTab:true});
